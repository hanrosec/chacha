#include <stdio.h>

#include "chacha.h"

int main() {
    // Test case (https://datatracker.ietf.org/doc/html/rfc8439)
    uint32_t key[KEY_SIZE] = {
        0x03020100, 0x07060504, 0x0b0a0908, 0x0f0e0d0c,
        0x13121110, 0x17161514, 0x1b1a1918, 0x1f1e1d1c};
    uint32_t nonce[NONCE_SIZE] = {0x00000000, 0x4a000000, 0x00000000};
    uint8_t plaintext[114] = {
        0x4c,0x61,0x64,0x69,
        0x65,0x73,0x20,0x61,
        0x6e,0x64,0x20,0x47,
        0x65,0x6e,0x74,0x6c,
        0x65,0x6d,0x65,0x6e,
        0x20,0x6f,0x66,0x20,
        0x74,0x68,0x65,0x20,
        0x63,0x6c,0x61,0x73,
        0x73,0x20,0x6f,0x66,
        0x20,0x27,0x39,0x39,
        0x3a,0x20,0x49,0x66,
        0x20,0x49,0x20,0x63,
        0x6f,0x75,0x6c,0x64,
        0x20,0x6f,0x66,0x66,
        0x65,0x72,0x20,0x79,
        0x6f,0x75,0x20,0x6f,
        0x6e,0x6c,0x79,0x20,
        0x6f,0x6e,0x65,0x20,
        0x74,0x69,0x70,0x20,
        0x66,0x6f,0x72,0x20,
        0x74,0x68,0x65,0x20,
        0x66,0x75,0x74,0x75,
        0x72,0x65,0x2c,0x20,
        0x73,0x75,0x6e,0x73,
        0x63,0x72,0x65,0x65,
        0x6e,0x20,0x77,0x6f,
        0x75,0x6c,0x64,0x20,
        0x62,0x65,0x20,0x69,
        0x74,0x2e};
    uint8_t ciphertext[sizeof(plaintext)];

    encrypt(plaintext, sizeof(plaintext), key, nonce, ciphertext);

    for (size_t i = 1; i < sizeof(plaintext)+1; i++) {
        printf("%02x ", ciphertext[i-1]);
    }
    printf("\n");

    uint8_t plaintext2[114];
    
    decrypt(ciphertext, sizeof(ciphertext), key, nonce, plaintext2);
    for (size_t i = 1; i < sizeof(plaintext)+1; i++) {
        printf("%02x ", plaintext[i-1]);
    }
    printf("\n");
}